___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "User Data Extractor From Page",
  "categories": [
    "UTILITY",
    "ADVERTISING",
    "ANALYTICS",
    "PERSONALIZATION"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "stape.io",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "This tag automatically extracts user PII (email, phone, name) from a webpage\u0027s DOM. It intelligently identifies form fields, normalizes data, and can push results to a dataLayer or browser storage.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "userDataGroup",
    "displayName": "User Data to be Extracted",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "email",
        "checkboxText": "Email",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "phone",
        "checkboxText": "Phone",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "city",
        "checkboxText": "City",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "country",
        "checkboxText": "Country",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "postalCode",
        "checkboxText": "Postal Code",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "firstName",
        "checkboxText": "First Name",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "lastName",
        "checkboxText": "Last Name",
        "simpleValueType": true,
        "defaultValue": false
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "extractionSettingsGroup",
    "displayName": "Extraction Settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "saveIntoStorage",
        "checkboxText": "Save user_data information into the browser Storage",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "GROUP",
            "name": "saveIntoStorageGroup",
            "subParams": [
              {
                "type": "SELECT",
                "name": "saveIntoStorageType",
                "displayName": "Storage Type",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "session",
                    "displayValue": "Session Storage"
                  },
                  {
                    "value": "local",
                    "displayValue": "Local Storage"
                  }
                ],
                "simpleValueType": true,
                "help": "Choose if the \u003ci\u003euser_data\u003c/i\u003e information will be stored in the \u003ca href\u003d\"https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage\"\u003eSession Storage\u003c/a\u003e or \u003ca href\u003d\"https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage\"\u003eLocal Storage\u003c/a\u003e.",
                "defaultValue": "session"
              },
              {
                "type": "TEXT",
                "name": "saveIntoStorageKey",
                "displayName": "Storage Key",
                "simpleValueType": true,
                "help": "The key that wiIl contain the data in the Storage.\n\u003cbr/\u003e\nIf not set, \u003ci\u003egtm_user_data\u003c/i\u003e will be used.",
                "defaultValue": "gtm_user_data"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "saveIntoStorage",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "If enabled, it will save the captured \u003ci\u003euser_data\u003c/i\u003e information to Session or Local Storage.",
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "pushToDataLayer",
        "checkboxText": "Push an event to the dataLayer with user_data information",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "GROUP",
            "name": "pushToDataLayerGroup",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "TEXT",
                "name": "pushToDataLayerEventName",
                "displayName": "Data Layer Event Name",
                "simpleValueType": true,
                "help": "If not set, \u003ci\u003euser_data_detected\u003c/i\u003e will be used.",
                "defaultValue": "user_data_detected"
              },
              {
                "type": "TEXT",
                "name": "pushToDataLayerDataLayerName",
                "displayName": "Data Layer Array Name",
                "simpleValueType": true,
                "help": "If not set, \u003ci\u003edataLayer\u003c/i\u003e will be used.",
                "defaultValue": "dataLayer"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "pushToDataLayer",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "If enabled, the following event will be pushed to the data layer:\n\u003cbr/\u003e\n{\n\u003cbr/\u003e\n\u0026nbsp;\u0026nbsp;event: \u003ci\u003e{{eventName}}\u003c/i\u003e,\n\u003cbr/\u003e\n\u0026nbsp;\u0026nbsp;user_data: \u003ci\u003e{{userData object}}\u003c/i\u003e, \n\u003cbr/\u003e\n\u0026nbsp;\u0026nbsp;_clear: true\n\u003cbr/\u003e\n}\n\u003cbr/\u003e\n\u003cbr/\u003e\nIt\u0027s useful if you want to capture \u003ci\u003euser_data\u003c/i\u003e information after when a specific data layer event occurs."
      },
      {
        "type": "CHECKBOX",
        "name": "autoTrackSpecificClicks",
        "checkboxText": "Automatically track clicks at specific HTML elements",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "GROUP",
            "name": "autoTrackSpecificClicksGroup",
            "subParams": [
              {
                "type": "TEXT",
                "name": "autoTrackSpecificClicksSelector",
                "displayName": "Auto Track Submit Clicks Override CSS Selector",
                "simpleValueType": true,
                "help": "If set, the click listener will listen for click at elements that matches the specified CSS selector.\u003cbr/\u003eIf left blank, it will listen for clicks on type\u003d\"submit\" \u0026lt;button\u0026gt; and \u0026lt;input\u0026gt; HTML elements."
              }
            ],
            "enablingConditions": [
              {
                "paramName": "autoTrackSpecificClicks",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "If enabled, by default it will track clicks all type\u003d\"submit\" \u0026lt;button\u0026gt; and \u0026lt;input\u0026gt; HTML elements and try to detect \u003ci\u003euser_data\u003c/i\u003e information."
      },
      {
        "type": "CHECKBOX",
        "name": "overrideRootElement",
        "checkboxText": "Override the root HTML element to scan within",
        "simpleValueType": true,
        "help": "By default, it uses the \u003ci\u003edocument\u003c/i\u003e HTML element.",
        "subParams": [
          {
            "type": "GROUP",
            "name": "overrideRootElementGroup",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "TEXT",
                "name": "overrideRootElementElement",
                "displayName": "Overriden root HTML element",
                "simpleValueType": true,
                "help": "Input a variable that returns the desired HTML element.",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "enablingConditions": [
              {
                "paramName": "overrideRootElement",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "moreSettingsGroup",
    "displayName": "More Settings",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "scriptUrl",
        "displayName": "Script URL",
        "simpleValueType": true,
        "defaultValue": "https://stapecdn.com/user-data-extractor/${script-version}.js",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "REGEX",
            "args": [
              "^(https://).+(\\.js)$"
            ]
          }
        ],
        "help": "The URL load script from.\n\u003cbr/\u003e\nBy default it will be loaded from \u003ci\u003ehttps://stapecdn.com/user-data-extractor/${script-version}.js\u003c/i\u003e.\n\u003cbr/\u003e\nIf the \u003ci\u003e${script-version}\u003c/i\u003e is left as is, the tag will always try to load the latest version. Otherwise, you can specify a specific version in its place, such as: \u003ci\u003ev1\u003ci\u003e."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "logsGroup",
    "displayName": "Logs Settings",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

/// <reference path="./web-gtm-sandboxed-apis.d.ts" />

const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const getContainerVersion = require('getContainerVersion');
const getType = require('getType');
const injectScript = require('injectScript');
const JSON = require('JSON');
const logToConsole = require('logToConsole');
const setInWindow = require('setInWindow');

/*==============================================================================
==============================================================================*/

const scriptUrl = getScriptUrl(data);
const scriptGlobalFlagName = 'gtm_userDataExtractorScriptLoaded';
const scriptLoaded = copyFromWindow(scriptGlobalFlagName);

const settings = getScriptSettings(data);

if (!scriptLoaded || !scriptLoaded[scriptUrl]) {
  log({
    Name: 'UserDataExtractor',
    Type: 'Message',
    Message: 'Loading User Data Extractor script.'
  });

  injectScript(
    scriptUrl,
    () => {
      log({
        Name: 'UserDataExtractor',
        Type: 'Message',
        Message: 'User Data Extractor script loaded succesfully.'
      });
      const flagValue = scriptLoaded || {};
      flagValue[scriptUrl] = true;
      setInWindow(scriptGlobalFlagName, flagValue);

      log({
        Name: 'UserDataExtractor',
        Type: 'Message',
        Message: 'User Data Extractor script is already loaded. Running user data extraction.'
      });

      runUserDataExtraction(settings);
    },
    () => {
      log({
        Name: 'UserDataExtractor',
        Type: 'Message',
        Message: 'User Data Extractor script failed to load.'
      });

      data.gtmOnFailure();
    },
    scriptUrl
  );
} else {
  log({
    Name: 'UserDataExtractor',
    Type: 'Message',
    Message: 'User Data Extractor script is already loaded. Running user data extraction.'
  });

  runUserDataExtraction(settings);
}

/*==============================================================================
  Vendor related functions
==============================================================================*/

function getScriptUrl(data) {
  const scriptVersion = 'v1';
  const scriptUrl =
    getType(data.scriptUrl) === 'string'
      ? data.scriptUrl.replace('${script-version}', scriptVersion)
      : 'https://stapecdn.com/user-data-extractor/' + scriptVersion + '.js';
  return scriptUrl;
}

function getScriptSettings(data) {
  const settings = {};

  settings.extract = {};
  if (data.email) settings.extract.email = data.email;
  if (data.phone) settings.extract.phone = data.phone;
  if (data.city) settings.extract.city = data.city;
  if (data.country) settings.extract.country = data.country;
  if (data.postalCode) settings.extract.postal_code = data.postalCode;
  if (data.firstName) settings.extract.first_name = data.firstName;
  if (data.lastName) settings.extract.last_name = data.lastName;

  if (data.overrideRootElement && data.overrideRootElementElement) {
    settings.root = data.overrideRootElementElement;
  }

  if (data.pushToDataLayer) {
    settings.pushToDataLayer = {
      enabled: true
    };
    if (getType(data.pushToDataLayerEventName) === 'string') {
      settings.pushToDataLayer.event = data.pushToDataLayerEventName;
    }
    if (getType(data.pushToDataLayerDataLayerName) === 'string') {
      settings.pushToDataLayer.dataLayerName = data.pushToDataLayerDataLayerName;
    }
  }

  if (data.autoTrackSpecificClicks) {
    settings.autoTrackSpecificClicks = {
      enabled: true
    };
    if (getType(data.autoTrackSpecificClicksSelector) === 'string') {
      settings.autoTrackSpecificClicks.buttonClickSelector = data.autoTrackSpecificClicksSelector;
    }
  }

  if (data.saveIntoStorage) {
    settings.saveIntoStorage = {
      enabled: true
    };
    if (data.saveIntoStorageType) settings.saveIntoStorage.type = data.saveIntoStorageType;
    if (getType(data.saveIntoStorageKey) === 'string') {
      settings.saveIntoStorage.key = data.saveIntoStorageKey;
    }
  }

  return settings;
}

function runUserDataExtraction(settings) {
  const userData = callInWindow('extractUserDataAuto', settings);
  log({
    Name: 'UserDataExtractor',
    Type: 'Message',
    Message: 'Extracted User Data: ' + JSON.stringify(userData)
  });

  data.gtmOnSuccess();
}

/*==============================================================================
  Helpers
==============================================================================*/

function log(dataToLog) {
  if (!determinateIsLoggingEnabled()) return;
  logToConsole(dataToLog);
}

function determinateIsLoggingEnabled() {
  const containerVersion = getContainerVersion();
  const isDebug = !!(
    containerVersion &&
    (containerVersion.debugMode || containerVersion.previewMode)
  );

  if (!data.logType) {
    return isDebug;
  }

  if (data.logType === 'no') {
    return false;
  }

  if (data.logType === 'debug') {
    return isDebug;
  }

  return data.logType === 'always';
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtm_userDataExtractorScriptLoaded"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "extractUserDataAuto"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://stapecdn.com/*"
              },
              {
                "type": 1,
                "string": "https://cdn.stape.io/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Script is NOT loaded, the template tries to load it but an error occurs, failure
    handler should be called, extractor function should NOT be called
  code: |-
    setMockData();

    mock('copyFromWindow', (key) => {
      if (key === scriptGlobalFlagName) {
        return undefined;
      }
    });

    mock('injectScript', (scriptUrl, successHandler, failureHandler, cacheToken) => {
      assertThat(scriptUrl).isEqualTo(mockData.scriptUrl);
      assertThat(successHandler).isFunction();
      assertThat(failureHandler).isFunction();
      assertThat(cacheToken).isEqualTo(mockData.scriptUrl);
      failureHandler();
    });

    runCode(mockData);

    assertApi('setInWindow').wasNotCalled();
    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
    assertApi('gtmOnSuccess').wasNotCalled();
- name: Script is NOT loaded, the template should load it successfully, extractor
    function should be called
  code: |-
    setMockData({
      autoTrackSpecificClicks: { enabled: true, autoTrackSpecificClicksSelector: 'a.submit' }
    });

    mock('copyFromWindow', (key) => {
      if (key === scriptGlobalFlagName) {
        return undefined;
      }
    });

    mock('injectScript', (scriptUrl, successHandler, failureHandler, cacheToken) => {
      assertThat(scriptUrl).isEqualTo(mockData.scriptUrl);
      assertThat(successHandler).isFunction();
      assertThat(failureHandler).isFunction();
      assertThat(cacheToken).isEqualTo(mockData.scriptUrl);
      successHandler();
    });

    mock('callInWindow', () => {
      const name = arguments[0];
      if (name === extractorFunctionName) {
        const settings = arguments[1];
        assertThat(settings).isEqualTo(expectedFormattedSettings);
        return {
          email: 'email',
          phone: 'phone',
          city: 'city',
          postal_code: 'postal_code',
          country: 'countr',
          first_name: 'first_name',
          last_name: 'last_name'
        };
      }
      fail(extractorFunctionName + ' should have been called.');
    });

    runCode(mockData);

    const flagValue = {};
    flagValue[mockData.scriptUrl] = true;
    assertApi('setInWindow').wasCalledWith(scriptGlobalFlagName, flagValue);

    assertApi('gtmOnFailure').wasNotCalled();
    assertApi('gtmOnSuccess').wasCalled();
- name: Script is loaded, the template should not attempt to load it, extractor function
    should be called
  code: |-
    setMockData();

    mock('copyFromWindow', (key) => {
      if (key === scriptGlobalFlagName) {
        const flagValue = {};
        flagValue[mockData.scriptUrl] = true;
        return flagValue;
      }
    });

    mock('callInWindow', () => {
      const name = arguments[0];
      if (name === extractorFunctionName) {
        const settings = arguments[1];
        assertThat(settings).isEqualTo(expectedFormattedSettings);
        return {
          email: 'email',
          phone: 'phone',
          city: 'city',
          postal_code: 'postal_code',
          country: 'countr',
          first_name: 'first_name',
          last_name: 'last_name'
        };
      }
      fail(extractorFunctionName + ' should have been called.');
    });

    runCode(mockData);

    assertApi('injectScript').wasNotCalled();
    assertApi('setInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasNotCalled();
    assertApi('gtmOnSuccess').wasCalled();
- name: '[Logs] Should log to console'
  code: "const originalMockData = setMockData();\n\n[\n  // if the 'Always log to\
    \ console' option is selected\n  { mockData: { logType: 'always' }, expectedDebugMode:\
    \ true },\n  // if the 'Log during debug and preview' option is selected AND is\
    \ on preview mode\n  { mockData: { logType: 'debug' }, expectedDebugMode: true\
    \ },\n].forEach(scenario => {\n  const copyMockData = JSON.parse(JSON.stringify(originalMockData));\n\
    \  mergeObj(copyMockData, scenario.mockData);\n  \n  mock('getContainerVersion',\
    \ () => {\n    return {\n      debugMode: scenario.expectedDebugMode\n    };\n\
    \  }); \n\n  runCode(copyMockData);\n  \n  assertApi('logToConsole').wasCalled();\n\
    \  assertApi('gtmOnSuccess').wasCalled();\n  assertApi('gtmOnFailure').wasNotCalled();\n\
    });"
- name: '[Logs] Should NOT log to console'
  code: "const originalMockData = setMockData();\n\n[\n  // if the 'Log during debug\
    \ and preview' option is selected AND is NOT on preview mode\n  { mockData: {\
    \ logType: 'debug' }, expectedDebugMode: false },\n  // if the 'Do not log' option\
    \ is selected\n  { mockData: { logType: 'no' }, expectedDebugMode: undefined },\n\
    ].forEach(scenario => {\n  const copyMockData = JSON.parse(JSON.stringify(originalMockData));\n\
    \  mergeObj(copyMockData, scenario.mockData);\n  \n  mock('getContainerVersion',\
    \ () => {\n    return {\n      debugMode: scenario.expectedDebugMode\n    };\n\
    \  });\n  \n  runCode(copyMockData);\n\n  assertApi('logToConsole').wasNotCalled();\n\
    \  assertApi('gtmOnSuccess').wasCalled();\n  assertApi('gtmOnFailure').wasNotCalled();\n\
    });"
setup: "const JSON = require('JSON');\nconst Object = require('Object');\n\nfunction\
  \ mergeObj(target, source) {\n  for (const key in source) {\n    if (source.hasOwnProperty(key))\
  \ target[key] = source[key];\n  }\n  return target;\n}\n\nconst scriptGlobalFlagName\
  \ = 'gtm_userDataExtractorScriptLoaded';\nconst extractorFunctionName = 'extractUserDataAuto';\n\
  const expectedFormattedSettings = {\n  extract: { email: true, phone: true, city:\
  \ true, country: true, postal_code: true, first_name: true, last_name: true },\n\
  \  root: 'test',\n  pushToDataLayer: {\n    enabled: true,\n    event: 'user_data_detected',\n\
  \    dataLayerName: 'dataLayer'\n  },\n  autoTrackSpecificClicks: { enabled: true,\
  \ buttonClickSelector: 'a.submit' },\n  saveIntoStorage: { enabled: true, type:\
  \ 'session', key: 'gtm_user_data' }\n};\n\nconst mockData = {};\n\nconst setMockData\
  \ = (objToBeMerged) => {\n  const base = {\n    email: true,\n    phone: true,\n\
  \    city: true,\n    postalCode: true,\n    country: true,\n    firstName: true,\n\
  \    lastName: true,\n    pushToDataLayer: true,\n    pushToDataLayerDataLayerName:\
  \ 'dataLayer',\n    pushToDataLayerEventName: 'user_data_detected',\n    saveIntoStorage:\
  \ true,\n    saveIntoStorageType: 'session',\n    saveIntoStorageKey: 'gtm_user_data',\n\
  \    autoTrackSpecificClicks: true,\n    autoTrackSpecificClicksSelector: 'a.submit',\n\
  \    overrideRootElement: true,\n    overrideRootElementElement: 'test',\n    scriptUrl:\
  \ 'https://stapecdn.com/user-data-extractor/v1.js',\n    logType: 'debug'\n  };\n\
  \  \n  mergeObj(base, objToBeMerged || {});\n  mergeObj(mockData, base);\n  return\
  \ mockData;\n};\n\nmock('copyFromWindow', (key) => {\n  if (key === scriptGlobalFlagName)\
  \ {\n    return { };\n  }\n});\n\nmock('injectScript', (scriptUrl, successHandler,\
  \ failureHandler, cacheToken) => {\n  successHandler();\n});\n\nmock('callInWindow',\
  \ () => {\n  const name = arguments[0];\n  if (name === extractorFunctionName) {\n\
  \    return {\n      email: 'email',\n      phone: 'phone',\n      city: 'city',\n\
  \      postal_code: 'postal_code',\n      country: 'countr',\n      first_name:\
  \ 'first_name',\n      last_name: 'last_name'\n    };\n  }\n});"


___NOTES___

Created on 26.2.2024 14.09.01

