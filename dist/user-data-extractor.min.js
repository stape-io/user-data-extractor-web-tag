/*! @stape-io/user-data-extractor v1.0.0 | 2025-11-03T17:58:46.888Z */
var extractUserDataAuto=function(){"use strict";let e=!1;function a(p={}){try{const b={root:document,extract:{email:!0,phone:!0,city:!1,country:!1,postal_code:!1,first_name:!1,last_name:!1},overrideExistingUserData:!1,pushToDataLayer:{enabled:!1,event:"user_data_detected",dataLayerName:"dataLayer"},autoTrackSpecificClicks:{enabled:!1,buttonClickSelector:null},autoTrackSpecificForms:{enabled:!1,formSelector:null},saveIntoStorage:{enabled:!1,type:"session",key:"gtm_user_data"}},h={...b,...p,pushToDataLayer:{...b.pushToDataLayer,...p.pushToDataLayer||{}},autoTrackSpecificClicks:{...b.autoTrackSpecificClicks,...p.autoTrackSpecificClicks||{}},autoTrackSpecificForms:{...b.autoTrackSpecificForms,...p.autoTrackSpecificForms||{}},saveIntoStorage:{...b.saveIntoStorage,...p.saveIntoStorage||{}}};!function(t){try{const{autoTrackSpecificClicks:{enabled:n,buttonClickSelector:r}}=t;if(!n||e)return;document.addEventListener("click",e=>{try{const n=r||'button[type="submit"], input[type="submit"]',i=e.target.closest(n);i&&a({...t,root:i.form||document})}catch(e){console.error("Error in addSubmitClickListener click event handler:",e)}},!0),e=!0}catch(e){console.error("Error in addSubmitClickListener:",e)}}(h),function(t){try{const{autoTrackSpecificForms:{enabled:n,formSelector:r}}=t;if(!n)return;document.addEventListener("submit",e=>{try{const n=r||"form",i=e.target.closest(n);i&&a({...t,root:i||document})}catch(e){console.error("Error in addSubmitFormListener click event handler:",e)}},!0),e=!0}catch(e){console.error("Error in addSubmitClickListener:",e)}}(h);const v=function(e){const{root:a,extract:f}=e,p=function(e){const a=[],t=[],n=Array.from(e.querySelectorAll("input, textarea"));for(const e of n)r(e)&&a.push(e);const i=Array.from(e.querySelectorAll("select"));for(const e of i)r(e)&&t.push(e);return{inputsAndTextAreas:a,selects:t}}(a),b={};if(f.email){const e=function(e){const{inputsAndTextAreas:a}=e,n=["support","noreply"],r=function(){try{return location.hostname||""}catch(e){return""}}(),i=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,o=[],s=new Set,c=e=>{if(e)return e.trim().toLowerCase()},u=e=>!!e&&(!n.some(a=>e.includes(a))&&(!r||!function(e,a){try{const t=e.split("@")[1]||"";return a&&t&&a===t}catch(e){return!1}}(e,r)));for(const e of a){const a=(e.getAttribute("type")||"").toLowerCase(),n=(e.getAttribute("id")||"").toLowerCase(),r=(e.getAttribute("name")||"").toLowerCase(),l=(e.getAttribute("placeholder")||"").toLowerCase();if(!("email"===a||n.includes("email")||r.includes("email")||l.includes("email")))continue;const d=String(e.value||"").match(i);if(!d)continue;const f=c(d[0]);u(f)&&!s.has(f)&&(s.add(f),o.push({value:f,el:e,score:t({el:e,value:f,source:e.tagName.toLowerCase(),visible:m(e)})}))}return o}(p),a=n(e);a&&(b.email=a.value)}if(f.phone){const e=function(e){const{inputsAndTextAreas:a}=e,n=/[\-@#<>'",; ]|\(|\)|\+|[a-z]/gi,r=/^00/,i=/^\d{7,}$/,o=/^\+?\d{1,4}[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/,s=[],c=new Set,u=e=>{if(e)return String(e).replace(n,"").replace(r,"").replace(/[^\d]/g,"")},l=(e,a)=>a&&i.test(a)||"string"==typeof e&&o.test(e.trim());for(const e of a){const a=(e.getAttribute("type")||"").toLowerCase(),n=(e.getAttribute("id")||"").toLowerCase(),r=(e.getAttribute("name")||"").toLowerCase(),i=(e.getAttribute("placeholder")||"").toLowerCase();if(!("tel"===a||n.includes("phone")||r.includes("phone")||n.includes("tel")||r.includes("tel")||i.includes("phone")||i.includes("tel")))continue;const o=e.value,d=u(o);l(o,d)&&!c.has(d)&&(c.add(d),s.push({value:d,el:e,score:t({el:e,value:d,source:e.tagName.toLowerCase(),visible:m(e)})}))}return s}(p),a=n(e);a&&(b.phone=a.value)}if(f.city){const e=function(e){const a=[...e.inputsAndTextAreas,...e.selects],n=["city","$city"],r=[],i=new Set,c=e=>{if(e)return String(e).toLowerCase().trim()},u=(e,a)=>s(e,a,n);for(const e of a){const a=o(e);if(!a)continue;if(!u(e,a))continue;const n=c(a);n&&!i.has(n)&&(i.add(n),r.push({value:n,el:e,score:t({el:e,value:n,source:e.tagName.toLowerCase(),visible:m(e)})}))}return r}(p),a=n(e);a&&(b.city=a.value)}if(f.country){const e=function(e){const a=[...e.inputsAndTextAreas,...e.selects],n=["country"],r=[],i=new Set,c=(e,a)=>s(e,a,n),u=(e,a)=>{const t=String(e||"").toLowerCase().trim().replace(/[^a-z]/g,"");if(!t)return"";if(2===t.length)return t;if(a[t])return a[t];for(const e of Object.keys(a))if(t.includes(e))return a[e];return t},l=(e,{skipMapping:a=!1}={})=>{if(!e)return;let t=String(e);return a||(t=u(t,g)),t=t.toLowerCase().replace(/[^a-z]/g,""),/^[a-z]+$/.test(t)?t.substring(0,2):null};for(const e of a){const a=o(e);if(!a)continue;if(!c(e,a))continue;const n=l(a);n&&!i.has(n)&&(i.add(n),r.push({value:n,el:e,score:t({el:e,value:n,source:e.tagName.toLowerCase(),visible:m(e)})}))}return r}(p),a=n(e);a&&(b.country=a.value)}if(f.postal_code){const e=function(e){const a=[...e.inputsAndTextAreas,...e.selects],n=["zip","zcode","pcode","postalcode","postcode"],r=[],i=new Set,c=(e,a)=>s(e,a,n),u=e=>{if(!e)return;const a=String(e).trim();return/^\d{5}(?:[-\s]\d{4})?$/.test(a)?a:null};for(const e of a){const a=o(e);if(!a)continue;if(!c(e,a))continue;const n=u(a);n&&!i.has(n)&&(i.add(n),r.push({value:n,el:e,score:t({el:e,value:n,source:e.tagName.toLowerCase(),visible:m(e)})}))}return r}(p),a=n(e);a&&(b.postal_code=a.value)}if(f.first_name){const e=function(e){const{inputsAndTextAreas:a}=e,n=[],r=new Set,o=e=>["firstname","fn","fname","givenname","forename"].some(a=>c(e,a));for(const e of a){const a=u(e);if(!a.value)continue;let s=null;if(o(a))s=a.value;else if(l(a)){const[e]=d(a.value);e&&(s=e)}if(s){const a=i(s);a&&!r.has(a)&&(r.add(a),n.push({value:a,el:e,score:t({el:e,value:a,source:e.tagName.toLowerCase(),visible:m(e)})}))}}return n}(p),a=n(e);a&&(b.first_name=a.value)}if(f.last_name){const e=function(e){const{inputsAndTextAreas:a}=e,n=[],r=new Set,o=e=>["lastname","ln","lname","surname","sname","familyname"].some(a=>c(e,a));for(const e of a){const a=u(e);if(!a.value)continue;let s=null;if(o(a))s=a.value;else if(l(a)){const[,e]=d(a.value);e&&(s=e)}if(s){const a=i(s);a&&!r.has(a)&&(r.add(a),n.push({value:a,el:e,score:t({el:e,value:a,source:e.tagName.toLowerCase(),visible:m(e)})}))}}return n}(p),a=n(e);a&&(b.last_name=a.value)}return b}(h),y=function(e){try{const{saveIntoStorage:{enabled:a,type:t="session",key:n="gtm_user_data"}}=e,r={session:window.sessionStorage,local:window.localStorage};if(!a)return;const i=r[t].getItem(n);if(!i)return;return JSON.parse(i)}catch(e){console.error("Error in getFromStorage:",e)}}(h),k={...a.userData,...y,...v}||{},w=a.userData=h.overrideExistingUserData?v:k;return function(e,a){try{const{pushToDataLayer:{enabled:t,dataLayerName:n="dataLayer",event:r="user_data_detected"}}=a;if(!t||f(e))return;const i={event:r,user_data:e,_clear:!0},o=n;window[o]=window[o]||[],window[o].push(i)}catch(e){console.error("Error in pushToDataLayer:",e)}}(w,h),function(e,a){try{const{saveIntoStorage:{enabled:t,type:n="session",key:r="gtm_user_data"}}=a,i={session:window.sessionStorage,local:window.localStorage};if(!t||f(e))return;i[n].setItem(r,JSON.stringify(e))}catch(e){console.error("Error in saveIntoStorage:",e)}}(w,h),w}catch(e){return console.error("Error in extractUserDataAuto:",e),{}}}function t(e){let a=0;return"input"===e.source&&(a+=2),e.visible&&(a+=2),function(e,a){try{return e&&e.closest?e.closest(a):null}catch(e){return null}}(e.el,"a")&&(a-=2),a-=Math.min(2,Math.max(0,(e.value.length-18)/20)),a}function n(e){if(!e||0===e.length)return null;const a=e=>{const a=function(e,a){if(!e||!a)return Number.POSITIVE_INFINITY;let t=0,n=e;for(;n;){if(n===a)return t;t++,n=n.parentElement}return t+1e3}(e,t);return Number.isFinite(a)?a:1e9},t=document.activeElement;return e.slice().sort((e,t)=>t.score!==e.score?t.score-e.score:a(e.el)-a(t.el))[0]}function r(e){const a=(e.getAttribute("type")||"").toLowerCase();if("password"===a||"hidden"===a||"button"===a||"submit"===a||"image"===a)return!1;const t=(e.tagName||"").toLowerCase();return!["script","style","noscript","image","br","svg","path","canvas"].includes(t)}function i(e){return"string"!=typeof e||e.length>100?null:e.trim().toLowerCase()}function o(e){if("SELECT"===e.tagName){const a=e.selectedOptions&&e.selectedOptions[0];return(a&&(a.textContent||a.value)||"").trim()}return/^(checkbox|radio)$/i.test(e.type)?e.checked?(e.value||e.getAttribute("value")||"").trim():"":(e.value||"").trim()}function s(e,a,t){const n=e.getAttribute("id")||"",r=e.getAttribute("name")||"",i=e.getAttribute("placeholder")||"",o=(e,a)=>{const t=(e||"").toLowerCase(),n=a.toLowerCase();return n.length>2?t.includes(n):t===n};return t.some(e=>o(n,e)||o(r,e)||o(i,e)||o(a,e))}function c(e,a){const t=[e.name,e.id,e.placeholder,e.value].map(e=>(e||"").toLowerCase()),n=a.toLowerCase();return n.length>2?t.some(e=>e.includes(n)):t.some(e=>e===n)}function u(e){return{id:(e.getAttribute("id")||"").trim(),name:(e.getAttribute("name")||"").trim(),placeholder:(e.getAttribute("placeholder")||"").trim(),value:o(e),inputType:(e.getAttribute("type")||"").toLowerCase()}}function l(e){return["fullname"].some(a=>c(e,a))}function d(e){const a=(e||"").trim().split(/\s+/);return[a[0]||"",a.slice(1).join(" ").trim()]}function m(e){const a=getComputedStyle(e);if("none"===a.display||"hidden"===a.visibility||0===parseFloat(a.opacity||"1"))return!1;const t=e.getBoundingClientRect();return!!(t.width>0&&t.height>0)}function f(e){return!(!e||"object"!=typeof e)&&0===Object.keys(e).length}const g={unitedstates:"us",usa:"us",ind:"in",afghanistan:"af",alandislands:"ax",albania:"al",algeria:"dz",americansamoa:"as",andorra:"ad",angola:"ao",anguilla:"ai",antarctica:"aq",antiguaandbarbuda:"ag",argentina:"ar",armenia:"am",aruba:"aw",australia:"au",austria:"at",azerbaijan:"az",bahamas:"bs",bahrain:"bh",bangladesh:"bd",barbados:"bb",belarus:"by",belgium:"be",belize:"bz",benin:"bj",bermuda:"bm",bhutan:"bt",boliviaplurinationalstateof:"bo",bolivia:"bo",bonairesinteustatinsandsaba:"bq",bosniaandherzegovina:"ba",botswana:"bw",bouvetisland:"bv",brazil:"br",britishindianoceanterritory:"io",bruneidarussalam:"bn",brunei:"bn",bulgaria:"bg",burkinafaso:"bf",burundi:"bi",cambodia:"kh",cameroon:"cm",canada:"ca",capeverde:"cv",caymanislands:"ky",centralafricanrepublic:"cf",chad:"td",chile:"cl",china:"cn",christmasisland:"cx",cocoskeelingislands:"cc",colombia:"co",comoros:"km",congo:"cg",congothedemocraticrepublicofthe:"cd",democraticrepublicofthecongo:"cd",cookislands:"ck",costarica:"cr",cotedivoire:"ci",ivorycoast:"ci",croatia:"hr",cuba:"cu",curacao:"cw",cyprus:"cy",czechrepublic:"cz",denmark:"dk",djibouti:"dj",dominica:"dm",dominicanrepublic:"do",ecuador:"ec",egypt:"eg",elsalvador:"sv",equatorialguinea:"gq",eritrea:"er",estonia:"ee",ethiopia:"et",falklandislandsmalvinas:"fk",faroeislands:"fo",fiji:"fj",finland:"fi",france:"fr",frenchguiana:"gf",frenchpolynesia:"pf",frenchsouthernterritories:"tf",gabon:"ga",gambia:"gm",georgia:"ge",germany:"de",ghana:"gh",gibraltar:"gi",greece:"gr",greenland:"gl",grenada:"gd",guadeloupe:"gp",guam:"gu",guatemala:"gt",guernsey:"gg",guinea:"gn",guineabissau:"gw",guyana:"gy",haiti:"ht",heardislandandmcdonaldislands:"hm",holyseevaticancitystate:"va",vatican:"va",honduras:"hn",hongkong:"hk",hungary:"hu",iceland:"is",india:"in",indonesia:"id",iranislamicrepublicof:"ir",iran:"ir",iraq:"iq",ireland:"ie",isleofman:"im",israel:"il",italy:"it",jamaica:"jm",japan:"jp",jersey:"je",jordan:"jo",kazakhstan:"kz",kenya:"ke",kiribati:"ki",koreademocraticpeoplesrepublicof:"kp",northkorea:"kp",korearepublicof:"kr",southkorea:"kr",kuwait:"kw",kyrgyzstan:"kg",laopeoplesdemocraticrepublic:"la",laos:"la",latvia:"lv",lebanon:"lb",lesotho:"ls",liberia:"lr",libya:"ly",liechtenstein:"li",lithuania:"lt",luxembourg:"lu",macao:"mo",macedoniatheformeryugoslavrepublicof:"mk",macedonia:"mk",madagascar:"mg",malawi:"mw",malaysia:"my",maldives:"mv",mali:"ml",malta:"mt",marshallislands:"mh",martinique:"mq",mauritania:"mr",mauritius:"mu",mayotte:"yt",mexico:"mx",micronesiafederatedstatesof:"fm",micronesia:"fm",moldovarepublicof:"md",moldova:"md",monaco:"mc",mongolia:"mn",montenegro:"me",montserrat:"ms",morocco:"ma",mozambique:"mz",myanmar:"mm",namibia:"na",nauru:"nr",nepal:"np",netherlands:"nl",newcaledonia:"nc",newzealand:"nz",nicaragua:"ni",niger:"ne",nigeria:"ng",niue:"nu",norfolkisland:"nf",northernmarianaislands:"mp",norway:"no",oman:"om",pakistan:"pk",palau:"pw",palestinestateof:"ps",palestine:"ps",panama:"pa",papuanewguinea:"pg",paraguay:"py",peru:"pe",philippines:"ph",pitcairn:"pn",poland:"pl",portugal:"pt",puertorico:"pr",qatar:"qa",reunion:"re",romania:"ro",russianfederation:"ru",russia:"ru",rwanda:"rw",saintbarthelemy:"bl",sainthelenaascensionandtristandacunha:"sh",saintkittsandnevis:"kn",saintlucia:"lc",saintmartinfrenchpart:"mf",saintpierreandmiquelon:"pm",saintvincentandthegrenadines:"vc",samoa:"ws",sanmarino:"sm",saotomeandprincipe:"st",saudiarabia:"sa",senegal:"sn",serbia:"rs",seychelles:"sc",sierraleone:"sl",singapore:"sg",sintmaartenductchpart:"sx",slovakia:"sk",slovenia:"si",solomonislands:"sb",somalia:"so",southafrica:"za",southgeorgiaandthesouthsandwichislands:"gs",southsudan:"ss",spain:"es",srilanka:"lk",sudan:"sd",suriname:"sr",svalbardandjanmayen:"sj",eswatini:"sz",swaziland:"sz",sweden:"se",switzerland:"ch",syrianarabrepublic:"sy",syria:"sy",taiwanprovinceofchina:"tw",taiwan:"tw",tajikistan:"tj",tanzaniaunitedrepublicof:"tz",tanzania:"tz",thailand:"th",timorleste:"tl",easttimor:"tl",togo:"tg",tokelau:"tk",tonga:"to",trinidadandtobago:"tt",tunisia:"tn",turkey:"tr",turkmenistan:"tm",turksandcaicosislands:"tc",tuvalu:"tv",uganda:"ug",ukraine:"ua",unitedarabemirates:"ae",unitedkingdom:"gb",unitedstatesofamerica:"us",unitedstatesminoroutlyingislands:"um",uruguay:"uy",uzbekistan:"uz",vanuatu:"vu",venezuelabolivarianrepublicof:"ve",venezuela:"ve",vietnam:"vn",virginislandsbritish:"vg",virginislandsus:"vi",wallisandfutuna:"wf",westernsahara:"eh",yemen:"ye",zambia:"zm",zimbabwe:"zw"};return a}();
